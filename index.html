<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Î≥µÏã§Ïù¥ Î∂ÑÏÑùÍ∏∞</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="https://code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">
        
    <!-- React Í¥ÄÎ†® Ïä§ÌÅ¨Î¶ΩÌä∏ -->
    <script src="https://unpkg.com/react@17/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@17/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/babel-standalone@6/babel.min.js"></script>

</head>
<body>
    <!-- ÏÇ¨Ïù¥ÎìúÎ∞î  -->
    <div class="background-image"></div>
    <div class="content">
        <h1>Î≥µÏã§Ïù¥ Î∂ÑÏÑùÍ∏∞ v.1.1.6</h1>
        
        <!-- ÌååÏùº ÏÑ†ÌÉù ÌôîÎ©¥ -->
        <div id="fileSelectionScreen">
            <input type="file" id="excelFile" accept=".xlsx, .xls">
            <button onclick="loadExcelFile()">ÌååÏùº Î°úÎìú</button>
        </div>
        
        <div id="analysisScreen" style="display: none;">
            <div id="sidebar-root"></div>
            <!-- Î≥µÏã§Ïù¥ Ï°¥Ïû¨Í∞ê Ïä¨ÎùºÏù¥Îçî -->
            <div class="boksil-presence">
                <label for="boksilOpacity">Î≥µÏã§Ïù¥ Ï°¥Ïû¨Í∞ê:</label>
                <input type="range" id="boksilOpacity" min="0" max="100" value="30">
            </div>
                        
            <!-- Î¶¨Í∑∏ ÏÑ†ÌÉù -->
            <div id="leagueSelection">
                <h3 class="league-toggle" onclick="toggleLeagueCheckboxes()">Î¶¨Í∑∏ ÏÑ†ÌÉù (Ïó¥Í∏∞)</h3>
                <div class="league-checkboxes">
                    <!-- Checkboxes will be dynamically inserted here -->
                </div>
            </div>
            <div id="oddsSelection">
                <label>
                    <input type="radio" name="oddsType" value="avg" checked> ÌèâÍ∑† Î∞∞Îãπ(Avg)
                </label>
                <label>
                    <input type="radio" name="oddsType" value="b365"> Bet365 Î∞∞Îãπ
                </label>
                <label>
                    <input type="radio" name="oddsType" value="ps"> Pinnacle Sports Î∞∞Îãπ
                </label>
            </div>
            <!-- Í≤ÄÏÉâ Ìèº -->
            <form id="searchForm">
                <table>
                    <tr>
                        <td>Î¶¨Í∑∏</td>
                        <td>Ï†ïÎ∞∞</td>
                        <td>Î¨¥</td>
                        <td>Ïó≠Î∞∞</td>
                    </tr>
                    <tr>
                        <td>
                            <select id="currentLeague">
                                <option value="">ÏÑ†ÌÉùÎêú Î¶¨Í∑∏</option>
                            </select>
                        </td>
                        <td><input type="number" name="win" step="0.01" value="1.55" required></td>
                        <td><input type="number" name="draw" step="0.01" value="4.58" required></td>
                        <td><input type="number" name="lose" step="0.01" value="5.55" required></td>
                    </tr>
                </table>
                <button type="submit">Í≤ÄÏÉâ</button>
                <button type="button" id="marginSettingsButton">Í≤ÄÏÉâ ÎßàÏßÑ ÏÑ§Ï†ï</button>
            </form>
        
            <!-- ÎßàÏßÑ ÏÑ§Ï†ï (Í∏∞Ï°¥ ÏΩîÎìú Ïú†ÏßÄ) -->
            <div id="marginSettings" style="display: none;">
                <h3>Í≤ÄÏÉâ ÎßàÏßÑ ÏÉÅÏÑ∏ ÏÑ§Ï†ï</h3>
                <div>
                    <h4>Ï†ïÎ∞∞ ÌëúÎ≥∏ ÎßàÏßÑ</h4>
                    <div class="margin-labels">
                        <span>Ï†ïÎ∞∞</span>
                        <span>Î¨¥</span>
                        <span>Ïó≠Î∞∞</span>
                    </div>
                    <div class="margin-inputs">
                        <input type="number" id="jeongbaeMargin" placeholder="Ï†ïÎ∞∞" step="0.01" value="0.04">
                        <input type="number" id="jeongbaeMuMargin" placeholder="Î¨¥" step="0.01" value="0.07">
                        <input type="number" id="jeongbaeYeokbaeMargin" placeholder="Ïó≠Î∞∞" step="0.01" value="0.09">
                    </div>
                </div>
                <div>
                    <h4>Ïó≠Î∞∞ ÌëúÎ≥∏ ÎßàÏßÑ</h4>
                    <div class="margin-labels">
                        <span>Ï†ïÎ∞∞</span>
                        <span>Î¨¥</span>
                        <span>Ïó≠Î∞∞</span>
                    </div>
                    <div class="margin-inputs">
                        <input type="number" id="yeokbaeJeongbaeMargin" placeholder="Ï†ïÎ∞∞" step="0.01" value="0.04">
                        <input type="number" id="yeokbaeMuMargin" placeholder="Î¨¥" step="0.01" value="0.07">
                        <input type="number" id="yeokbaeMargin" placeholder="Ïó≠Î∞∞" step="0.01" value="0.09">
                    </div>
                </div>
                <div>
                    <h4>ÏäπÎ¨¥Ìå® ÏùºÏπò ÎßàÏßÑ</h4>
                    <div class="margin-labels">
                        <span>Ï†ïÎ∞∞</span>
                        <span>Î¨¥</span>
                        <span>Ïó≠Î∞∞</span>
                    </div>
                    <div class="margin-inputs">
                        <input type="number" id="matchJeongbaeMargin" placeholder="Ï†ïÎ∞∞" step="0.01" value="0.04">
                        <input type="number" id="matchMuMargin" placeholder="Î¨¥" step="0.01" value="0.07">
                        <input type="number" id="matchYeokbaeMargin" placeholder="Ïó≠Î∞∞" step="0.01" value="0.09">
                    </div>
                </div>
                <button id="applyMarginSettings">Ï†ÅÏö©</button>
            </div>
            
            <!-- ÎÇ†Ïßú Î≤îÏúÑ ÌïÑÌÑ∞ -->
            <div id="dateRangeFilter">
                <h3>ÎÇ†Ïßú Î≤îÏúÑ ÌïÑÌÑ∞</h3>
                <div id="dateSlider"></div>
                <div id="dateDisplay">
                    <span id="startDate"></span> - <span id="endDate"></span>
                </div>
            </div>
            <div id="yearlyDateRangeFilter">
                <h3>Ïó∞Ï§ë ÌäπÏ†ï Í∏∞Í∞Ñ ÌïÑÌÑ∞</h3>
                <div id="yearlyDateSlider"></div>
                <div id="yearlyDateDisplay">
                    <span id="yearlyStartDate"></span> - <span id="yearlyEndDate"></span>
                </div>
            </div>
        <!--<div id="dataOutput"></div> -->
       
        <table class="results-table">
            <tr>
                <th>ÌëúÎ≥∏</th>
                <th>Ìï∏Ïäπ</th>
                <th>Ìï∏Î¨¥</th>
                <th>Î¨¥</th>
                <th>Ïó≠</th>
                <th>Ï†ïÎ∞∞</th>
                <th>ÌîåÌï∏</th>
            </tr>
            <tr>
                <th><span>Ï†ïÎ∞∞ ÌëúÎ≥∏</span><button class="detail-button" onclick="toggleDetails('jeongbae')">ÏÉÅÏÑ∏</button></th>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
            </tr>
            <tr class="details-row" id="jeongbae-details" style="display: none;">
                <td colspan="7">
                    <div class="details-content">
                        <div class="summary-container"></div>
                        <div class="details-container"></div>
                    </div>
                </td>
            </tr>
            <tr>
                <th><span>Ï†ïÎ∞∞+Î¨¥ ÌëúÎ≥∏</span> <button class="detail-button" onclick="toggleDetails('jeongbaeMu')">ÏÉÅÏÑ∏</button></th>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
            </tr>
            <tr class="details-row" id="jeongbaeMu-details" style="display: none;">
                <td colspan="7">
                    <div class="details-content">
                        <div class="summary-container"></div>
                        <div class="details-container"></div>
                    </div>
                </td>
            </tr>
            <tr>
                <th><span>Ïó≠Î∞∞ ÌëúÎ≥∏</span> <button class="detail-button" onclick="toggleDetails('yeokbae')">ÏÉÅÏÑ∏</button></th>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
            </tr>
            <tr class="details-row" id="yeokbae-details" style="display: none;">
                <td colspan="7">
                    <div class="details-content">
                        <div class="summary-container"></div>
                        <div class="details-container"></div>
                    </div>
                </td>
            </tr>
            <tr>
                <th><span>Ïó≠Î∞∞+Î¨¥ ÌëúÎ≥∏</span> <button class="detail-button" onclick="toggleDetails('yeokbaeMu')">ÏÉÅÏÑ∏</button></th>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
            </tr>
            <tr class="details-row" id="yeokbaeMu-details" style="display: none;">
                <td colspan="7">
                    <div class="details-content">
                        <div class="summary-container"></div>
                        <div class="details-container"></div>
                    </div>
                </td>
            </tr>
            <tr>
                <th><span>Ìï¥ÎãπÎ¶¨Í∑∏ Ï†ïÎ∞∞+Î¨¥ ÌëúÎ≥∏</span> <button class="detail-button" onclick="toggleDetails('selectedLeagueJeongbaeMu')">ÏÉÅÏÑ∏</button></th>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
            </tr>
            <tr class="details-row" id="selectedLeagueJeongbaeMu-details" style="display: none;">
                <td colspan="7">
                    <div class="details-content">
                        <div class="summary-container"></div>
                        <div class="details-container"></div>
                    </div>
                </td>
            </tr>
            <tr>
                <th><span>Ìï¥ÎãπÎ¶¨Í∑∏ Ïó≠Î∞∞+Î¨¥ ÌëúÎ≥∏</span> <button class="detail-button" onclick="toggleDetails('selectedLeagueYeokbaeMu')">ÏÉÅÏÑ∏</button></th>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
            </tr>
            <tr class="details-row" id="selectedLeagueYeokbaeMu-details" style="display: none;">
                <td colspan="7">
                    <div class="details-content">
                        <div class="summary-container"></div>
                        <div class="details-container"></div>
                    </div>
                </td>
            </tr>
            <tr>
                <th><span>Ïäπ(Î¨¥)Ìå® ÏùºÏπò ÌëúÎ≥∏</span> <button class="detail-button" onclick="toggleDetails('allMatchSample')">ÏÉÅÏÑ∏</button></th>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
            </tr>
            <tr class="details-row" id="allMatchSample-details" style="display: none;">
                <td colspan="7">
                    <div class="details-content">
                        <div class="summary-container"></div>
                        <div class="details-container"></div>
                    </div>
                </td>
            </tr>
            <tr>
                <th><span>ÎãπÎ¶¨Í∑∏ ÏäπÎ¨¥Ìå® ÏùºÏπò ÌëúÎ≥∏</span> <button class="detail-button" onclick="toggleDetails('currentLeagueMatchSample')">ÏÉÅÏÑ∏</button></th>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
            </tr>
            <tr class="details-row" id="currentLeagueMatchSample-details" style="display: none;">
                <td colspan="7">
                    <div class="details-content">
                        <div class="summary-container"></div>
                        <div class="details-container"></div>
                    </div>
                </td>
            </tr>
        </table>

    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.min.js"></script>
    <script src="search.js"></script>
    <script src="analyzeData.js"></script>
    <script type="text/babel">
        // React hooks Í∞ÄÏ†∏Ïò§Í∏∞
        const { useState, useEffect } = React;
        
        const Sidebar = () => {
          const [isOpen, setIsOpen] = useState(true);
          const [searchHistory, setSearchHistory] = useState([]);
          const [showSettings, setShowSettings] = useState(false);
              
          useEffect(() => {
            const savedHistory = localStorage.getItem('searchHistory');
            if (savedHistory) {
              setSearchHistory(JSON.parse(savedHistory));
            }
        
            window.addEventListener('searchCompleted', handleSearchCompleted);
            return () => window.removeEventListener('searchCompleted', handleSearchCompleted);
          }, []);
        
          const handleSearchCompleted = (event) => {
            const { selectedLeagues, currentLeague, win, draw, lose } = event.detail;
            
            const newEntry = {
            id: Date.now(),
            timestamp: new Date().toLocaleString(),
            selectedLeagues,
            currentLeague,
            odds: { win, draw, lose }
            };

            setSearchHistory(prevHistory => {
            const lastEntry = prevHistory[0];
            if (lastEntry && 
                lastEntry.currentLeague === currentLeague &&
                JSON.stringify(lastEntry.selectedLeagues) === JSON.stringify(selectedLeagues) &&
                lastEntry.odds.win === win &&
                lastEntry.odds.draw === draw &&
                lastEntry.odds.lose === lose) {
                return prevHistory;
            }
            
            const updatedHistory = [newEntry, ...prevHistory];
            localStorage.setItem('searchHistory', JSON.stringify(updatedHistory));
            return updatedHistory;
            });
        };
        
          const deleteHistoryEntry = (id) => {
            setSearchHistory(prevHistory => {
              const updatedHistory = prevHistory.filter(entry => entry.id !== id);
              localStorage.setItem('searchHistory', JSON.stringify(updatedHistory));
              return updatedHistory;
            });
          };
        
          const clearHistory = () => {
            setSearchHistory([]);
            localStorage.removeItem('searchHistory');
          };
          
          const handleHistoryClick = (entry) => {
              // rerunSearch Ìï®Ïàò Ìò∏Ï∂ú
              rerunSearch(entry);
          };        
          
          return (
            <div className="relative">
              <button 
                onClick={() => setIsOpen(!isOpen)}
                style={{
                  position: 'absolute',
                  top: '1rem',
                  right: '-2rem',
                  backgroundColor: '#e5e7eb',
                  padding: '0.25rem',
                  borderRadius: '0 0.25rem 0.25rem 0',
                  cursor: 'pointer',
                  border: 'none'
                }}
              >
                {isOpen ? '‚óÄ' : '‚ñ∂'}
              </button>
        
              <div style={{
                height: '100vh',
                width: '256px',
                backgroundColor: 'white',
                boxShadow: '2px 0 8px rgba(0,0,0,0.1)',
                transition: 'transform 0.3s',
                transform: isOpen ? 'translateX(0)' : 'translateX(-256px)',
                position: 'fixed',
                top: 0,
                left: 0,
                zIndex: 50,
                display: 'flex',
                flexDirection: 'column'
            }}>
                <div style={{
                flex: 1,
                overflowY: 'auto',
                padding: '1rem'
                }}>
                <div style={{
                    display: 'flex',
                    justifyContent: 'space-between',
                    alignItems: 'center',
                    marginBottom: '1rem'
                }}>
                    <h2 style={{
                    fontSize: '1.125rem',
                    fontWeight: '600',
                    }}>
                    üìú Í≤ÄÏÉâ Í∏∞Î°ù
                    </h2>
                    <button
                    onClick={clearHistory}
                    style={{
                        fontSize: '0.875rem',
                        color: '#ef4444',
                        border: 'none',
                        background: 'none',
                        cursor: 'pointer'
                    }}
                    >
                    Ï†ÑÏ≤¥ ÏÇ≠Ï†ú
                    </button>
                </div>

                <div style={{ display: 'flex', flexDirection: 'column', gap: '0.75rem' }}>
                    {searchHistory.map(entry => (
                    <div
                        key={entry.id}
                        onClick={() => handleHistoryClick(entry)}
                        style={{
                            backgroundColor: '#f9fafb',
                            padding: '0.5rem 1rem',
                            borderRadius: '0.5rem',
                            position: 'relative',
                            cursor: 'pointer',
                            transition: 'background-color 0.2s'
                        }}
                        onMouseOver={e => {
                            e.currentTarget.style.backgroundColor = '#f0f1f3';
                            const deleteButton = e.currentTarget.querySelector('.delete-button');
                            if (deleteButton) deleteButton.style.opacity = '1';
                        }}
                        onMouseOut={e => {
                            e.currentTarget.style.backgroundColor = '#f9fafb';
                            const deleteButton = e.currentTarget.querySelector('.delete-button');
                            if (deleteButton) deleteButton.style.opacity = '0';
                        }}
                    >
                        <div style={{ 
                            fontSize: '0.75rem', 
                            color: '#6b7280',
                            marginBottom: '0.25rem'
                        }}>
                            {entry.timestamp}
                        </div>
                        <div style={{
                            display: 'flex',
                            alignItems: 'center',
                            gap: '0.5rem',
                            fontSize: '0.875rem'
                        }}>
                            <span style={{ 
                                minWidth: '30px',
                                color: entry.currentLeague ? '#4b5563' : '#9ca3af'
                            }}>
                                {entry.currentLeague || 'X'}
                            </span>
                            <div style={{
                                display: 'flex',
                                gap: '1rem',
                                color: '#4b5563'
                            }}>
                                <span>{entry.odds.win}</span>
                                <span>{entry.odds.draw}</span>
                                <span>{entry.odds.lose}</span>
                            </div>
                        </div>
                        <button
                            className="delete-button"
                            onClick={(e) => {
                                e.stopPropagation();
                                deleteHistoryEntry(entry.id);
                            }}
                            style={{
                                position: 'absolute',
                                top: '50%',
                                transform: 'translateY(-50%)',
                                right: '0.75rem',
                                width: '20px',
                                height: '20px',
                                borderRadius: '50%',
                                display: 'flex',
                                alignItems: 'center',
                                justifyContent: 'center',
                                border: 'none',
                                background: '#e5e7eb',
                                cursor: 'pointer',
                                opacity: 0,
                                transition: 'all 0.2s',
                                fontSize: '12px',
                                color: '#4b5563'
                            }}
                            onMouseOver={e => {
                                e.currentTarget.style.background = '#d1d5db';
                            }}
                            onMouseOut={e => {
                                e.currentTarget.style.background = '#e5e7eb';
                            }}
                        >
                            ‚úï
                        </button>
                    </div>
                ))}
                    {searchHistory.length === 0 && (
                    <div style={{
                        color: '#6b7280',
                        textAlign: 'center',
                        padding: '1rem 0'
                    }}>
                        Í≤ÄÏÉâ Í∏∞Î°ùÏù¥ ÏóÜÏäµÎãàÎã§
                    </div>
                    )}
                </div>
                </div>
        
                <div style={{
                  borderTop: '1px solid #e5e7eb',
                  padding: '1rem'
                }}>
                  <button
                    onClick={() => setShowSettings(!showSettings)}
                    style={{
                      width: '100%',
                      display: 'flex',
                      alignItems: 'center',
                      justifyContent: 'space-between',
                      padding: '0.5rem',
                      border: 'none',
                      background: 'none',
                      cursor: 'pointer',
                      borderRadius: '0.25rem'
                    }}
                  >
                    <div style={{ display: 'flex', alignItems: 'center' }}>
                      ‚öôÔ∏è ÏÑ§Ï†ï
                    </div>
                    <span style={{
                      transform: showSettings ? 'rotate(90deg)' : 'none',
                      transition: 'transform 0.2s'
                    }}>
                      ‚ñ∂
                    </span>
                  </button>
                  
                  {showSettings && (
                    <div style={{ marginLeft: '2rem' }}>
                      <button style={{
                        width: '100%',
                        textAlign: 'left',
                        padding: '0.5rem',
                        fontSize: '0.875rem',
                        border: 'none',
                        background: 'none',
                        cursor: 'pointer',
                        borderRadius: '0.25rem'
                      }}>
                        Îã§ÌÅ¨ Î™®Îìú
                      </button>
                      <button style={{
                        width: '100%',
                        textAlign: 'left',
                        padding: '0.5rem',
                        fontSize: '0.875rem',
                        border: 'none',
                        background: 'none',
                        cursor: 'pointer',
                        borderRadius: '0.25rem'
                      }}>
                        ÏïåÎ¶º ÏÑ§Ï†ï
                      </button>
                    </div>
                  )}
        
                  <div style={{
                    display: 'flex',
                    alignItems: 'center',
                    padding: '0.5rem',
                    marginTop: '0.5rem'
                  }}>
                    üë§ ÏÇ¨Ïö©Ïûê ÌîÑÎ°úÌïÑ
                  </div>
                </div>
              </div>
            </div>
          );
        };
        
        // ÏÇ¨Ïù¥ÎìúÎ∞î Î†åÎçîÎßÅ
        ReactDOM.render(
          <Sidebar />,
          document.getElementById('sidebar-root')
        );
        </script>
</body>
</html>